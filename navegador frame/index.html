<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <main>
        <div class="header-navigation">
            <div class="header-navigation-menu">
                <button id="showHideMenus" class="navigationBtn menuBtn"></button>
            </div>
            <div class="header-navigation-logo"><img src="images/phddobrasil.png" alt=""></div>
            <div class="header-navigation-btns">
                <button class="navigationBtn minimizeBtn" title="Minimize"></button>
                <button class="navigationBtn maximizeBtn" title="Maximize"></button>
                <button class="navigationBtn closeBtn" title="Close"></button>
            </div>
        </div>
        <div class="contentArea">
            <div id="mySidebar" class="leftMenu">
                <button class="navigationBtn moduloBtn user" id="iframeBtn">
                    <img src="icons/do-utilizador.png" alt="">
                    <h4>Leonardo Vanzella</h4>
                </button>
                <div class="modulo">
                    <a href="#" class="btn btn-white btn-        animate  moduloBtn2" id="ModuloDrop">cursos</a>
                    <!-- <button class="navigationBtn moduloBtn" id="ModuloDrop">
                        <p>Cursos</p>
                    </button> -->
                    <!--<div class="ModuloMenu">
                        <button class="OptionBtn moduloBtn" id="iframeBtn2" class="iframeBtn">
                            test
                        </button>
                        <button class="OptionBtn moduloBtn">
                            test
                        </button><button class="OptionBtn moduloBtn">
                            test
                        </button>
                    </div>-->
                </div>
            </div>
            <iframe src="" frameborder="0" id="iframe"></iframe>
        </div>
    </main>
    <script src="js/appFunction.js"></script>
    <script>
        const { remote } = require('electron');
        const path = require('path');
        $("#form").on('submit', function (e) {

            // nao submeter o form pelo php
            e.preventDefault();
            const email = $('#email').val();
            const password = $('#password').val();

            // ajax
            $.ajax({
                type: 'POST',
                url: 'http://192.168.10.80/api/auth',
                data: new FormData(this),
                dataType: 'json',
                contentType: false,
                cache: false,
                processData: false,
                beforeSend: function () {
                    $("#response").html('');
                    $("#loginBtn").val('validando...');
                },
                success: function (response) {

                    $("#loginBtn").val('entrar');
                    $("#loginBtn").removeAttr("disabled");

                    if (!response.errors && !response.message) {
                        localStorage.setItem('sessionToken', response.token);
                        console.log('Token armazenado:', localStorage.getItem('sessionToken')); // Verifique o valor do token armazenado
                        window.location.replace('index.html');
                        /*document.querySelector('.loginBtn').addEventListener('click', () => {
                           iframe.style.display = 'flex'
                           login.style.display = 'none'
                           leftMenu.style.display = 'flex'
                           mySidebar.style.width = '225px'
                           menu.forEach(element => {
                               element.style.visibility = 'visible';
                           })
                       })*/

                    } else {
                        $("#response").html('<div  class="alert alert-danger" role="alert">' + response.errors.email + '</div>');
                        $("#response").html('<div  class="alert alert-danger" role="alert">' + response.message + '</div>');
                        if (response.message) {
                            $.each(response.message, function (i, val) {
                                $("#response").append('<ul class="list-unstyled"> <li class="text-danger">' + val + '</li> </ul>');

                            })
                        }
                        if (response.errors) {
                            $.each(response.errors, function (key, value) {

                                $("#response").append('<ul class="list-unstyled"> <li class="text-danger">' + value + '</li> </ul>');

                            });
                        }

                        setTimeout(function () {
                            $("#response").html('');
                            $("#response").removeClass('alert alert-danger');
                        }, 3000);
                    }
                },
                errors: function () {
                    alert('Erro ao enviar formulÃ¡rio, por favor contate nosso suporte:(11)94952-2579 E-mail: console.tech@outlook.com');
                    $("#loginBtn").val('entrar');
                    $("#loginBtn").removeAttr("disabled");
                },

            });

        });


        //para desabilitar o button quando enviar o formulario
        $("form").submit(function () {
            $(this).find(":submit").attr('disabled', 'disabled');
        });

        if (window.location.pathname.endsWith('index.html')) {
            const token = localStorage.getItem('sessionToken');
            if (!token) {
                window.location.href = 'login.html';
            }
        }

        const logoutButton = document.getElementById('logout');
        if (logoutButton) {
            logoutButton.addEventListener('click', () => {
                localStorage.removeItem('sessionToken');
                window.location.href = 'login.html';
            });
        }

    </script>
</body>

</html>